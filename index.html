<!--
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⡴⣶⣷⣦⣤⣄⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⣿⣿⣿⣿⣿⡎⠙⠻⢿⣶⣄⡀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣿⡿⢿⣿⠉⠀⠀⠀⠀⠉⠻⣿⣦⡀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣶⣿⣿⣿⣿⣿⣾⣿⠀⠀⠀⠀⠀⠀⠀⠈⢿⣿⣦⡀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⠟⢻⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣷⡀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣥⡀⢸⣿⡿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣷⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⣿⣧⣸⣿⣧⠘⢿⣦⠀⠀⠀⠀⠀⠀⠀⠈⣿⣿⡇
⠀⠀⠀⠀⠀⠀⠀⢀⣿⣿⣿⣿⣿⡏⠻⣿⣄⠀⠙⢷⣄⠀⠀⠀⠀⠀⠀⣿⣿⣿
⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⣿⣿⣿⠁⠀⢹⣿⣿⣶⣦⣽⣳⠄⠀⠀⠀⠀⣿⣿⣿
⠀⠀⠀⠀⠀⠀⣰⣿⣿⡿⣿⣿⣿⠀⠀⠈⣿⣷⡀⠉⠛⢿⣷⡀⠀⠀⢀⣿⣿⡿
⠀⠀⠀⠀⠀⢠⣿⣿⠟⢁⣸⣿⣿⣀⣠⣾⣿⣿⣿⣦⡀⠀⠉⢹⠄⠀⣼⣿⣿⡇
⠘⡄⠀⠀⠀⣼⣿⣿⣿⣿⣿⢿⣿⣿⠉⠉⠀⠀⠀⠉⠻⠀⠀⠐⠀⣼⣿⣿⡟⠀
⠀⠘⢆⠀⠀⠘⠛⠋⠉⠀⠀⠀⢿⣿⡆⠀⠀⠀⠀⠀⠈⠀⠀⢀⣼⣿⣿⡟⠀⠀
⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⠀⠀⠸⣿⡇⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⠋⠀⠀⠀
⠀⠀⠀⠀⠈⠻⣦⣄⣀⠀⠀⠀⠀⣿⣷⠀⠀⢀⣀⣤⣾⣿⣿⡿⠛⠁⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠈⠙⠻⢿⣿⣶⣶⣾⣿⣾⣿⣿⣿⣿⠿⠛⠉⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠉⣿⣿⡉⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⡟⠀⠀⠀⠀
-->
<!DOCTYPE html>
<html lang="en" style="background-color: #191c1e;">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Destination Home Object Catalogue</title>
  <meta property="og:title" content="Destination Home Object Catalogue">
  <meta property="og:description" content="Browse through items and objects available on Destination Home.">
  <meta property="og:url" content="https://objects.destinationhome.live">
  <meta property="og:type" content="website">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<style>
.subtitle {
	display: flex;
	align-items: center;
}

.subtitle img {
	margin-right: 10px;
	/* Adjust as needed */
	border-radius: 10px;
}

.notification {
	display: none;
}

.notification.show {
	display: block;
	animation: fadeInOut 3s ease-in-out;
}

@keyframes fadeInOut {
	0%,
	100% {
		opacity: 0;
	}

	50% {
		opacity: 1;
	}
}

@keyframes fadeIn {
	from {
		opacity: 0;
	}

	to {
		opacity: 1;
	}
}

/* create css animation thats a loading skeleton for lazyloadbg class */
.lazyloadbg {
	background-color: #f0f0f0;
	background-image: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
	background-size: 200% 100%;
	animation: loading 1.4s infinite linear;
}

@keyframes loading {
	0% {
		background-position: 200% 0;
	}

	100% {
		background-position: -200% 0;
	}
}

.card-container {
	display: flex;
	flex-wrap: wrap;
	/* Ensures items wrap to the next row if there isn't enough space */
	justify-content: space-between;
	/* Adjust as needed */
}

.isRewardCard {
	background: linear-gradient(#fbcece, rgb(249 186 186 / 79%));
	background-size: cover;
	background-position: center;
	background-blend-mode: overlay;
}

.card {
	height: 90%;
	/* make sure the bottom corners are NOT rounded but keep the top ones */
	border-radius: 10px 10px 0 0;
}

.column {
	margin-bottom: 50px;
}

.img-lazyload {
	animation: fadeIn 1s;
}

.button-filter-a {
	padding: 10px;
	border-radius: 10px;
	background-color: #3c4042;
	color: white;
	cursor: pointer;
	font-size: 12px;
	margin-bottom: 10px;
	margin-right: 10px;
	user-select: none;
}

.button-filter-a-sel {
	padding: 10px;
	border-radius: 10px;
	background-color: #4b626e;
	color: white;
	cursor: pointer;
	font-size: 12px;
	margin-bottom: 10px;
	margin-right: 10px;
	user-select: none;
}

#container-2 {
	display: flex;
	flex-wrap: wrap;
}

#item-detail-list {
	position: fixed;
	bottom: 0;
	left: 0;
	width: 100%;
	background-color: #fff;
	box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
	display: none;
}

#item-detail-content {
	padding: 10px;
}

.init-element-anim-1 {
	animation: fadeInUp;
	animation-duration: 0.3s;
}

.init-element-anim-2 {
	animation: fadeInUp;
	animation-duration: 0.4s;
}

.init-element-anim-3 {
	animation: fadeInUp;
	animation-duration: 0.5s;
}

.init-element-anim-4 {
	animation: fadeInUp;
	animation-duration: 0.6s;
}

.init-element-anim-5 {
	animation: fadeInUp;
	animation-duration: 0.7s;
}

.loading-text-color {
	color: #191c1e;
}

.loading-text-anim {
	animation: fadeInUp;
	animation-duration: 0.3s;
}

#gradient-gif-anim {
	background-image: url('https://media2.giphy.com/media/FyoaJE2iah7WYeyxWr/giphy.gif');
	background-size: cover;
	background-clip: text;
	-webkit-background-clip: text;
	color: transparent;
	display: inline-block;
	animation: fadeIn 1s;
}

.card-anim-component {
	transition: transform 0.3s ease;
}

.card-anim-component:hover {
	transform: scale(1.02);
}

.isFeaturedItem {
	background: linear-gradient(#fafafa, rgb(249 186 186 / 79%));
	background-size: cover;
	background-position: center;
	background-blend-mode: overlay;
}

.object-container {
	max-width: 800px;
	padding: 20px;
}

.object-details {
	display: flex;
	align-items: center;
}

.object-image {
	flex: 1;
}

.object-image img {
	max-width: 100%;
	height: auto;
	border-radius: 5px;
}

.object-info {
	flex: 2;
	padding-left: 20px;
}

.object-title {
	font-size: 24px;
	margin-bottom: 10px;
}

.object-type,
.object-premium-reward,
.object-description,
.object-obtain-instructions,
.object-age-rating {
	margin-bottom: 10px;
	font-size: 16px;
}

.object-premium-reward {
	color: #007bff;
}

.object-age-rating {
	color: #ff0000;
}

.fab {
	position: fixed;
	bottom: 20px;
	right: 20px;
	background-color: #007bff;
	color: #fff;
	width: 50px;
	height: 50px;
	border-radius: 50%;
	text-align: center;
	line-height: 50px;
	font-size: 24px;
	cursor: pointer;
	box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.frosted-glass {
    background-color: rgb(19 29 45 / 71%);
    -webkit-backdrop-filter: blur(14px);
    backdrop-filter: blur(14px);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    color: white;
}


.frosted-alt {
	background-color: rgb(9 11 26 / 71%);
  -webkit-backdrop-filter: blur(14px);
	backdrop-filter: blur(14px);
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
	color: white;
}
</style>
<body style="background-color: #191c1e;">
<!-- Modal Details -->
<div id="modal-details" class="modal" style="animation: fadeInUp; animation-duration: 0.2s;">
    <!--<div class="modal-background" style="animation: fadeIn; animation-duration: 1s;"></div>-->
    <div class="modal-card" style="border: 2px solid #d1d1d1; border-radius: 20px;">
      <header class="modal-card-head frosted-alt">
        <p class="modal-card-title" style="color: white;">Object Details</p>
        <button id="close-modal" class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body frosted-glass">
        <!-- Content ... -->
        <div class="object-container">
          <div class="object-details">
              <div class="object-image">
                  <img src="resc/gray.webp" alt="Object Image" style="animation: fadeIn; animation-duration: 0.5s;">
              </div>
              <div class="object-info">
                  <h1 class="object-title" style="animation: fadeIn; animation-duration: 0.5s;">Object Name</h1>
                  <p class="object-type" style="animation: fadeIn; animation-duration: 0.5s;">Type: Type of Object</p>
                  <!--<p class="object-premium-reward">Premium/Reward</p>-->
                  <p class="object-description" style="animation: fadeIn; animation-duration: 0.5s;">Description: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus sit amet eleifend nunc.</p>
                  <p class="object-obtain-instructions" style="animation: fadeIn; animation-duration: 0.5s;">How to Obtain: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus sit amet eleifend nunc.</p>
                  <p class="object-age-rating" style="animation: fadeIn; animation-duration: 0.5s;">Age Rating: 18+</p>
              </div>
          </div>
      </div>
      <div class="object-container">
        <h1 class="object-title" style="animation: fadeIn; animation-duration: 0.5s; margin-left: -10px; margin-bottom: 17px;">Similar Objects</h1>
        <div id="similar-obj-dyn-cont"></div>
      </div>
        <!-- Content End-->
      </section>
      <footer class="modal-card-foot frosted-alt">
        <div class="buttons">
          <button onclick="" id="obj-detail-save" class="button">Save</button>
          <button onclick="" id="obj-detail-copy" class="button">Copy UUID</button>
        </div>
      </footer>
    </div>
  </div>

<!-- Modal List -->
<div id="modal-list" class="modal" style="animation: fadeInUp; animation-duration: 0.2s;">
    <div class="modal-background" style="animation: fadeIn; animation-duration: 1s;"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Saved Objects</span></p>
        <button id="close-modal" class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <!-- Replaced Body -->
      </section>
      <footer class="modal-card-foot">
        <div class="buttons">
          <button onclick="clearSavedItems();" class="button"><i class="fa-solid fa-trash"></i>&nbsp;Clear List</button>
          <button onclick="exportList();" class="button"><i class="fa-solid fa-file-export"></i>&nbsp;Export List</button>
        </div>
      </footer>
    </div>
  </div>
  <!-- Header -->
  <section class="hero is-primary" style="background-color: #191c1e; margin-bottom: -40px; margin-top: -10px;">
    <div class="hero-body">
      <div class="container">
        <!--<h1 class="title">
        </h1>-->
        <h3 class="subtitle">
            <img src="resc/logo.svg" width="35px" style="border-radius: 10px;">
            <span id="ahhtitle">Destination Home Object Catalogue <span style="font-size: 10px; color: gray;"><i>BETA</i></span></span>
        </h3>
      </div>
    </div>
  </section>

  <!-- Search Bar -->
  <section class="section" style="margin-top: -55px; margin-bottom: -53px;">
    <div class="container cutsie-anim-fast">
      <div class="field has-addons">
        <div class="control is-expanded">
          <input id="search-input" class="input" type="text" placeholder="Names, Keywords, Brands, etc.">
        </div>
        <div class="control">
          <a id="search-btn" class="button is-info" style="background-color: #24394b;">
            Search 🔍
          </a>
        </div>
      </div>
      <div id="misc-pages" class="cutsie-anim" style="margin-bottom: 10px;">
        <span id="saved-objects-list-button" onclick="toggleList()" class="button is-info saved-object-button" style="background-color: #24394b; margin-right: 10px;">Saved Objects</span>
        <!--<span class="button is-info" style="background-color: #24394b;">History</span>-->
      </div>
      <div id="container-2" class="cutsie-anim">
        <span id="filter-clothing" class="filter-button button-filter-a">Clothing</span>
        <span id="filter-furniture" class="filter-button button-filter-a">Furniture</span>
        <span id="filter-portable" class="filter-button button-filter-a">Portable</span>
        <span id="filter-scene" class="filter-button button-filter-a">Scene</span>
        <span id="filter-minigame" class="filter-button button-filter-a">Minigame</span>
    </div>
    <br>
        <div id="loading-spinner-elem" style="display: flex; align-items: center;">
            <img src="https://datapublic.uam.es/open/img-bi/spinner.gif" width="24px" id="loading-spinner" style="display: none;">
            <span id="loading-text" class="loading-text-color" style="display: none; margin-left: 10px;">Hang tight...</span>
        </div>
        <p id="result-amount"></p>
        <p id="no-result-text" style="display: none;">No results found 😔</p>
    </div>
  </section>

  <section class="section" id="search-results">
    <div class="container">
        <div id="featured-objects-title">
            <h2 class="subtitle" style="font-size: 24px; color: white;">
                ✨ <span id="gradient-gif-anim">Featured Objects</span>
            </h2>
            <br>
        </div>
      <div class="columns is-multiline is-mobile" id="search-container">
        <!-- Featured Objects -->

        <!-- Featured Objects End-->
      </div>
    </div>
  </section>

  <!-- Footer -->
  <div class="fab" id="fab" onclick="scrollToTop()"><i class="fa-solid fa-arrow-up"></i></div>
  <footer class="footer" style="background-color: #25282A; color: white; padding: 20px 0;">
    <div class="content has-text-centered">
      <p style="font-size: 16px;">&copy; Destination Home <br>Created with ❤️ by <span style="font-weight: bold;">Zeph</span> x <span style="font-weight: bold;">Sabrinica</span> ( and <i>Knight</i> )</p>
    </div>
  </footer>
<script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
<script>
document.getElementById('search-input').addEventListener('keypress', function(event) {
  if (event.key === 'Enter') {
    event.preventDefault();
    document.getElementById('search-btn').click();
  }
});
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
var resultSkeleton = `
<div class="[INIT_ANIM] column is-one-fifth-desktop is-one-fifth-tablet is-full-mobile card-anim-component" id="[UUID]">
  <div class="card [ITEM_CLASS]">
    <header class="card-header">
      <p class="card-header-title">[HEADER_PLACEHOLDER]</p>
        <span class="icon" style="margin-top: 8px; margin-right: 10px;">
            [GENDER_ICON]
        </span>
    </header>
    <div class="card-image">
      <figure class="image is-4by3 lazyloadbg">
        <img id="img-[UUID2]" style="object-fit: cover;" class="img-lazyload" src="[IMAGE_PLACEHOLDER]" alt="">
      </figure>
    </div>
    <div class="card-content">
      <div class="media">
        <div class="media-content">
            <p style="font-size: 10;">[ITEM_TYPE]</p>
            <p class="title is-6">[NAME_PLACEHOLDER]</p>
        </div>
      </div>
      <div class="content">
        [DESC_PLACEHOLDER]
      </div>
    </div>
  </div>
    <footer class="card-footer" style="background-color: lightgray; border-radius: 0 0 10px 10px;">
      <a onclick="objectView('[UUID3]');" class="card-footer-item">View</a>
      <a onclick="objectSave('[UUID4]');" class="card-footer-item save-button">Save</a>
      <a onclick="objectCopy('[UUID5]', '[ITEM_TYPE_2]');" class="card-footer-item">Copy</a>
    </footer>
</div>
`;

var similarObjSkeleton = `
<div class="columns is-multiline is-mobile" id="similar-objects">
  <div id="saved-item" style="animation: fadeInLeft; width: 100%; margin-bottom: 10px; background-color: rgb(9 11 26 / 71%); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: center;">
    <div style="display: flex; align-items: center;">
      <img id="saved-item-img" class="preview" src="[SIM_OBJ_IMG]" width="50" height="50" style="animation: fadeIn; animation-duration: 2s; object-fit: cover; width: 50px; height: 50px; border-radius: 10px;">
      <p style="margin-left: 10px; animation: fadeIn; animation-duration: 0.5s;"><b id="saved-item-name-">[SIM_OBJ_NAME]</b><br><span style="font-size: 13px;">[SIM_OBJ_TYPE]</span></p>
    </div>
    <div>
      <button onclick="objectViewFromSaved('[SIM_OBJ_UUID]');" class="button is-info" style="background-color: #24394b; animation: fadeIn; animation-duration: 0.5s;">View</button>
    </div>
  </div>
</div>
`;

var result_save = "";
var results_loaded = 0;
var results_total = 0;
var loadingtime = 0;

//document.querySelector('.button').addEventListener('click', function() {
//  var searchQuery = document.querySelector('.input').value;
//  fetchData(searchQuery);
//});

document.getElementById('search-btn').addEventListener('click', function() {
  var searchQuery = document.querySelector('.input').value;
  fetchData(searchQuery);
});

function showToast() {
  var toast = document.getElementById('toast');
  if (toast) {
    toast.classList.add('show');
  }
}

function hideToast() {
  var toast = document.getElementById('toast');
  if (toast) {
    toast.classList.remove('show');
  }
}

function fetchFeatured() {
    // Featured UUIDs to fetch
    var featuredUUIDs = ["B9764582-CAFF40D1-8401E815-35A4B0E0",
    "4E4CB6B1-B6744089-BEAA19FB-54B82C40",
    "94038602-245D4D83-BF79F6F6-99FEC5A4",
    "9461D3BB-329A4BF7-B769AA94-743438F2",
    "E60A3DB3-F791437F-BC98D55F-4E1D150D"];

    // Define resultSkeleton or use appropriate HTML string

    // for each of these ID's fetch the data via search and populate in the search-container
    featuredUUIDs.forEach(function(uuid) {
        var url = 'https://catalogue.destinationhome.live';
        var xhr = new XMLHttpRequest();
        xhr.open('POST', url, true);

        var headers = {
            'Accept-Encoding': 'gzip, deflate, br',
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Connection': 'keep-alive',
            'DNT': '1',
            'Origin': 'https://catalogue.destinationhome.live'
        };

        for (var key in headers) {
            xhr.setRequestHeader(key, headers[key]);
        }

        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    var searchResults = response.data.search;
                    var searchResult = searchResults[0];
                    var thisUuid = searchResult.uuid;
                    var thisImage = searchResult.images.small.replace('[THUMBNAIL_ROOT]', '');
                    var thisImage = "https://raw.githubusercontent.com/DestinationHome/ImageArchive/master/" + thisUuid + "/" + thisImage;

                    var thisDescription = "No description available.";
                    if (searchResult.description !== null) {
                        thisDescription = searchResult.description.replace('[#Legal]', '');
                    }
                    if (thisDescription.length > 100) {
                        thisDescription = thisDescription.substring(0, 100) + "...";
                    }
                    var gender = "";
                    var gender_icon = "";
                
                    var itemType = searchResult.type;
                    var itemTypeNormal = itemType.toLowerCase().charAt(0).toUpperCase() + itemType.slice(1).toLowerCase();
                    var itemClass = "";
                    var isItemAllowedToCopy = true;
                    if (itemType == "REWARD") {
                        itemClass = "isRewardCard";
                        isItemAllowedToCopy = false;
                    }
                
                    if (searchResult.name != null) {
                        if (searchResult.name.toLowerCase().includes("bundle") || searchResult.name.toLowerCase().includes("pack") || searchResult.name.toLowerCase().includes("set")) {
                            itemClass = "isRewardCard";
                            isItemAllowedToCopy = false;
                        }
                    }
                
                    var anim_ct = featuredUUIDs.indexOf(uuid) + 1;

                    var resultHTML = resultSkeleton
                        .replace('[IMAGE_PLACEHOLDER]', thisImage)
                        .replace('[NAME_PLACEHOLDER]', searchResult.name)
                        .replace('[UUID]', thisUuid)
                        .replace('[UUID2]', thisUuid)
                        .replace('[UUID3]', thisUuid)
                        .replace('[UUID4]', thisUuid)
                        .replace('[UUID5]', thisUuid)
                        .replace('[GENDER_ICON]', gender_icon)
                        .replace('[ITEM_CLASS]', 'isFeaturedItem')
                        .replace('[ITEM_TYPE]', itemTypeNormal)
                        .replace('[ITEM_TYPE_2]', itemClass)
                        .replace('[INIT_ANIM]', 'init-element-anim-'+anim_ct)
                        .replace('[HEADER_PLACEHOLDER]', '✨ Featured')
                        .replace('[DESC_PLACEHOLDER]', thisDescription);
                    document.getElementById('search-container').innerHTML += resultHTML;
                    setTimeout(removeImgLoading, 500, thisUuid);
                } else {
                    console.error('Request failed with status:', xhr.status);
                }
            }
        };

        var bodyData = JSON.stringify({
            query: "{\n  search(query:\""+uuid+"\", locale:DEFAULT) {\n    uuid\ntype\nname\ndescription\nimages{\nsmall\n}\nmetadata {\ntype\ngenders\n}\n  }\n}"
        });

        xhr.send(bodyData);
    });
}

function fetchData(searchQuery) {
  var url = 'https://catalogue.destinationhome.live';
  var xhr = new XMLHttpRequest();
  xhr.open('POST', url, true);

  var headers = {
    'Accept-Encoding': 'gzip, deflate, br',
    'Content-Type': 'application/json',
    'Accept': 'application/json',
    'Connection': 'keep-alive',
    'DNT': '1',
    'Origin': 'https://catalogue.destinationhome.live'
  };

  for (var key in headers) {
    xhr.setRequestHeader(key, headers[key]);
  }

  xhr.onreadystatechange = function () {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      if (xhr.status === 200) {
        document.getElementById('result-amount').style.display = 'block';
        document.getElementById('search-container').innerHTML = '';

        // hide no-result-text
        document.getElementById('no-result-text').style.display = 'none';

        // loop through the search results
        var searchResults = JSON.parse(xhr.responseText).data.search;
        result_save = searchResults;
        results_loaded = 0;
        results_total = searchResults.length;
        var totalResults = searchResults.length;
        if (totalResults === 0) {
          // show no-result-text
          document.getElementById('no-result-text').style.display = 'block';
        }
        document.getElementById('result-amount').textContent = 'Total of ' + totalResults + ' results';
        document.getElementById('loading-spinner').style.display = 'none';
        document.getElementById('loading-text').style.display = 'none';
        document.getElementById('loading-text').classList.remove('loading-text-anim');
        if (!document.getElementById('loading-text').classList.contains('loading-text-color')) {
            document.getElementById('loading-text').classList.add('loading-text-color');
        }

        // remove featured-objects-title
        document.getElementById('featured-objects-title').style.display = 'none';

        // only show the first 20 results
        for (var i = 0; i < 20; i++) {
            results_loaded++;
          var thisUuid = searchResults[i].uuid;
          var thisImage = searchResults[i].images.small;
          // remove [THUMBNAIL_ROOT] from thisImage
            var thisImage = thisImage.replace('[THUMBNAIL_ROOT]', '');
          var thisImage = "https://raw.githubusercontent.com/DestinationHome/ImageArchive/master/" + thisUuid + "/" + thisImage;

          var thisDescription = "No description available.";
          if (searchResults[i].description !== null) {
            thisDescription = searchResults[i].description;
            // remove [#Legal] from thisDescription
            thisDescription = thisDescription.replace('[#Legal]', '');
            }
            if (thisDescription.length > 100) {
                thisDescription = thisDescription.substring(0, 100) + "...";
            }

            var gender = "";
            var gender_icon = "";
            if (searchResults[i].metadata !== null) {
                var metadata = searchResults[i].metadata;
                if (metadata.genders && Array.isArray(metadata.genders)) {
                    gender = metadata.genders[0];
                }
            }

            if (gender == "FEMALE") {
                gender_icon = '<img src="female.png" width="50px">';
            }
            if (gender == "MALE") {
                gender_icon = '<img src="male.png" width="50px">';
            }

            var itemType = searchResults[i].type;
            var itemTypeNormal = itemType.toLowerCase().charAt(0).toUpperCase() + itemType.slice(1).toLowerCase();
            var itemClass = "";
            var isItemAllowedToCopy = true;
            if (itemType == "REWARD") {
                itemClass = "isRewardCard";
                isItemAllowedToCopy = false;
            }

            if (searchResults[i].name != null) {
            if (searchResults[i].name.toLowerCase().includes("bundle") || searchResults[i].name.toLowerCase().includes("pack") || searchResults[i].name.toLowerCase().includes("set")) {
                itemClass = "isRewardCard";
                isItemAllowedToCopy = false;
            }}

            var anim_ct = i + 1;

          // search up this UUID in results_save and return at which position it is
            var resultIndex = result_save.findIndex(x => x.uuid === thisUuid) + 1;
          var resultHTML = resultSkeleton
            .replace('[IMAGE_PLACEHOLDER]', thisImage)
            .replace('[NAME_PLACEHOLDER]', searchResults[i].name)
            .replace('[UUID]', thisUuid)
            .replace('[UUID2]', thisUuid)
            .replace('[UUID3]', thisUuid)
            .replace('[UUID4]', thisUuid)
            .replace('[UUID5]', thisUuid)
            .replace('[GENDER_ICON]', gender_icon)
            .replace('[ITEM_CLASS]', itemClass)
            .replace('[ITEM_TYPE]', itemTypeNormal)
            .replace('[ITEM_TYPE_2]', itemClass)
            .replace('[INIT_ANIM]', 'init-element-anim-'+anim_ct)
            .replace('[HEADER_PLACEHOLDER]', 'Result '+resultIndex)
            .replace('[DESC_PLACEHOLDER]', thisDescription);
          document.getElementById('search-container').innerHTML += resultHTML;
          setTimeout(removeImgLoading, 500, thisUuid);
        }
      } else {
        console.error('Request failed with status:', xhr.status);
      }
    }
  };

  var bodyData = JSON.stringify({
    query: "{\n  search(query:\""+searchQuery+"\", locale:DEFAULT) {\n    uuid\ntype\nname\ndescription\nimages{\nsmall\n}\nmetadata {\ntype\ngenders\n}\n  }\n}"
  });

    // show loading-spinner
    document.getElementById('result-amount').style.display = 'none';
    document.getElementById('loading-spinner').style.display = 'block';
    if (!document.getElementById('loading-text').classList.contains('loading-text-color')) {
        document.getElementById('loading-text').classList.add('loading-text-color');
    }

    // change the text within loading-text to either "Hang tight..." or "Loading more results...", choose a random one
    var loadingText = ["Running through the mall...", "Loading a million results...", "Almost there! Almost...", "Searching. Really. Fast...", "😴...", "Searching as fast as we can...", "Waking up our database...", "Forcing Zeph to hurry...", "Assembling the results...", "Just a moment...", "Loading results...", "Almost there...", "Asking the database to hurry up...", "Exploring the depths of our database..."];
    var randomLoadingText = loadingText[Math.floor(Math.random() * loadingText.length)];
    document.getElementById('loading-text').textContent = randomLoadingText;

    document.getElementById('loading-text').style.display = 'block';
    setTimeout(showLoadingText, 5000);
    xhr.send(bodyData);
}

var loadingResults = false; // Flag to track if results are being loaded

window.onscroll = function(ev) {
    if (loadingResults) {
        return; // If results are already being loaded, do nothing
    }

    if (results_loaded == results_total) {
        return;
    }

    var lastElement = document.getElementById('search-container').lastElementChild;
    if (!lastElement) {
        return;
    }
    var lastElementPosition = lastElement.getBoundingClientRect().bottom;
    var threshold = window.innerHeight * 2;

    if (lastElementPosition <= threshold) {
        // The 5th last element is in view or close to it, trigger loading more results
        console.log('5th last element is in view');
        console.log('Loaded: ' + results_loaded + ' Total: ' + results_total);
        loadMoreResults();
    }
};

function showLoadingText() {
    if (document.getElementById('loading-text').classList.contains('loading-text-color')) {
        document.getElementById('loading-text').classList.remove('loading-text-color');
        // add class loading-text-anim to it
        document.getElementById('loading-text').classList.add('loading-text-anim');
    }
}

function loadMoreResults() {
    loadingResults = true; // Set flag to true to indicate loading is in progress

    if (results_loaded >= results_total) {
        loadingResults = false; // Reset flag and stop loading if all results are already loaded
        return;
    }

    console.log('Loading more results');

    var resultsToLoad = Math.min(10, results_total - results_loaded); // Load up to 5 more results

    for (var i = results_loaded; i < results_loaded + resultsToLoad; i++) {
        var thisUuid = result_save[i].uuid;
        var resultIndex = result_save.findIndex(x => x.uuid === thisUuid) + 1;

        smallImageNull = false;
        largeImageNull = false;
        thisDescription = "No description available.";
        if (result_save[i].images && result_save[i].images.small == null) {
            smallImageNull = true;
        }
        if (result_save[i].images && result_save[i].images.large == null) {
            largeImageNull = true;
        }
        displayImage = "";
        if (!smallImageNull && result_save[i].images && result_save[i].images.small !== null) {
            displayImage = result_save[i].images.small;
        }
        if (!largeImageNull && result_save[i].images && result_save[i].images.large !== null) {
            displayImage = result_save[i].images.large;
        }

        if (result_save[i].description !== null) {
            thisDescription = result_save[i].description;
            thisDescription = thisDescription.replace('[#Legal]', '');
            if (thisDescription.length > 100) {
                thisDescription = thisDescription.substring(0, 100) + "...";
            }
        }

            var gender = "";
            var gender_icon = "";
            if (result_save[i].metadata !== null) {
                var metadata = result_save[i].metadata;
                if (metadata.genders && Array.isArray(metadata.genders)) {
                    gender = metadata.genders[0];
                }
            }

            if (gender == "FEMALE") {
                gender_icon = '<img src="female.png" width="50px">';
            }
            if (gender == "MALE") {
                gender_icon = '<img src="male.png" width="50px">';
            }

            var itemType = result_save[i].type;
            var itemTypeNormal = itemType.toLowerCase().charAt(0).toUpperCase() + itemType.slice(1).toLowerCase();
            var itemClass = "";
            var isItemAllowedToCopy = true;
            if (itemType == "REWARD") {
                itemClass = "isRewardCard";
                isItemAllowedToCopy = false;
            }

            // if in the item name there is "bundle" "pack" or "set", set itemClass to isRewardCard
            if (result_save[i].name != null) {
                if (result_save[i].name.toLowerCase().includes("bundle") || result_save[i].name.toLowerCase().includes("pack") || result_save[i].name.toLowerCase().includes("set")) {
                    itemClass = "isRewardCard";
                    isItemAllowedToCopy = false;
                }
            }

        // remove [THUMBNAIL_ROOT] from thisImage
        var displayImage = displayImage.replace('[THUMBNAIL_ROOT]', '');
        var displayImage = "https://raw.githubusercontent.com/DestinationHome/ImageArchive/master/" + thisUuid + "/" + displayImage;
        var resultHTML = resultSkeleton
            .replace('[IMAGE_PLACEHOLDER]', displayImage)
            .replace('[NAME_PLACEHOLDER]', result_save[i].name)
            .replace('[UUID]', thisUuid)
            .replace('[UUID2]', thisUuid)
            .replace('[UUID3]', thisUuid)
            .replace('[UUID4]', thisUuid)
            .replace('[UUID5]', thisUuid)
            .replace('[GENDER_ICON]', gender_icon)
            .replace('[ITEM_CLASS]', itemClass)
            .replace('[ITEM_TYPE]', itemTypeNormal)
            .replace('[ITEM_TYPE_2]', itemClass)
            .replace('[INIT_ANIM]', '')
            .replace('[HEADER_PLACEHOLDER]', 'Result '+resultIndex)
            .replace('[DESC_PLACEHOLDER]', thisDescription);
        document.getElementById('search-container').innerHTML += resultHTML;

        // after a second, remove the img-lazyload class from the images
        setTimeout(removeImgLoading, 500, thisUuid);
    }

    results_loaded += resultsToLoad; // Update the number of loaded results
    loadingResults = false; // Reset flag after loading is complete
}

var removed_init_anim = false;
function removeImgLoading(uuid) {
    var img = document.getElementById('img-' + uuid);
    if (img) {
        img.classList.remove('img-lazyload');
    }
    if (removed_init_anim == false) {
        var elements = document.getElementsByClassName('init-element-anim');
        while (elements.length > 0) {
            elements[0].classList.remove('init-element-anim');
        }
        removed_init_anim = true;
    }

    // remove all "init-element-anim-*" classes
    var elements = document.getElementsByClassName('init-element-anim-1');
    while (elements.length > 0) {
        elements[0].classList.remove('init-element-anim-1');
    }
    var elements = document.getElementsByClassName('init-element-anim-2');
    while (elements.length > 0) {
        elements[0].classList.remove('init-element-anim-2');
    }
    var elements = document.getElementsByClassName('init-element-anim-3');
    while (elements.length > 0) {
        elements[0].classList.remove('init-element-anim-3');
    }
    var elements = document.getElementsByClassName('init-element-anim-4');
    while (elements.length > 0) {
        elements[0].classList.remove('init-element-anim-4');
    }
    var elements = document.getElementsByClassName('init-element-anim-5');
    while (elements.length > 0) {
        elements[0].classList.remove('init-element-anim-5');
    }
}

document.addEventListener('error', function(e) {
    var elem = e.target;
    if (elem.tagName.toLowerCase() === 'img') {
        console.log('Image not found:', elem.src);
        if (elem.src.includes("small")) {
            elem.src = elem.src.replace("small", "large");
        } else {
            elem.src = 'https://via.placeholder.com/300x200';
        }
    }
}, true);

function objectCopy(uuid, type) {
    if (type == "isRewardCard") {
        var notyf = new Notyf();
        notyf.error('You cannot copy reward or bundle items!');
        return;
    }
    var copyText = document.createElement('textarea');
    copyText.value = uuid;
    document.body.appendChild(copyText);
    copyText.select();
    document.execCommand('copy');
    document.body.removeChild(copyText);
    var notyf = new Notyf();
    notyf.success('UUID copied to clipboard!');
}

function objectViewFromSaved(uuid) {
    // close all modals
    var modals = document.getElementsByClassName('modal');
    for (var i = 0; i < modals.length; i++) {
        modals[i].classList.remove('is-active');
    }
    objectView(uuid);
}

function objectView(uuid) {
  // set everything to empty
  document.querySelector('.object-title').textContent = '';
  document.querySelector('.object-type').textContent = '';
  document.querySelector('.object-description').textContent = '';
  document.querySelector('.object-image img').src = 'resc/gray.webp';
  document.querySelector('.object-age-rating').textContent = '';
  document.querySelector('.object-obtain-instructions').textContent = '';

  if (uuid == null) {
    return;
  }
  var url = 'https://catalogue.destinationhome.live';
  var xhr = new XMLHttpRequest();
  xhr.open('POST', url, true);

  var headers = {
    'Accept-Encoding': 'gzip, deflate, br',
    'Content-Type': 'application/json',
    'Accept': 'application/json',
    'Connection': 'keep-alive',
    'DNT': '1',
    'Origin': 'https://catalogue.destinationhome.live'
  };

  for (var key in headers) {
    xhr.setRequestHeader(key, headers[key]);
  }

  xhr.onreadystatechange = function () {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      if (xhr.status === 200) {
        var response = JSON.parse(xhr.responseText);
        var object = response.data.object;
        var objectName = object.name;
        var objectDescription = object.description;
        var objectType = object.type;

        if (object.images == null || object.images.small == null) {
          objectImage = 'resc/gray.webp';
        } else {
          var objectImage = object.images.small.replace('[THUMBNAIL_ROOT]', '');
          var objectImage = "https://raw.githubusercontent.com/DestinationHome/ImageArchive/master/" + uuid + "/" + objectImage;
        }

        // check if object.legal and objectLegal.ageRating even exist
        if (object.legal == null || object.legal.ageRating == null) {
          objectAgeRating = 0;
        } else {
          var objectLegal = object.legal;
          var objectAgeRating = objectLegal.ageRating.minimumAge;
          var objectMetadata = object.metadata;
        }

        var ageRatingImage = "<img height='40' src='resc/E.webp'>";
        if (objectAgeRating >= 3) {
          ageRatingImage = "<img height='40' src='resc/E.webp'>";
        }
        if (objectAgeRating >= 7) {
          ageRatingImage = "<img height='40' src='resc/E.webp'>";
        }
        if (objectAgeRating >= 12) {
          ageRatingImage = "<img height='40' src='resc/T.webp'>";
        }
        if (objectAgeRating >= 16) {
          ageRatingImage = "<img height='40' src='resc/M.webp'>";
        }
        if (objectAgeRating >= 18) {
          ageRatingImage = "<img height='40' src='resc/AO.webp'>";
        }

        var obtainInstructions = 'No obtain instructions found.';
        var objectNameLowercase = objectName.toLowerCase();
        if (objectNameLowercase.includes('bundle') || objectNameLowercase.includes('pack') || objectNameLowercase.includes('set')) {
          obtainInstructions = 'This item is a bundle, pack or set. It most likely cannot be obtained separately.';
        }

        // in object-description remove [#Legal] and replace \n with <br>
        objectDescription = objectDescription.replace('[#Legal]', '');
        objectDescription = objectDescription.replace(/\\n/g, '\n');
        objectDescription = objectDescription.replace(/\n/g, '<br>');
        console.log("After replacement:", objectDescription);

        
        // save info in html
        document.querySelector('.object-title').textContent = objectName;
        document.querySelector('.object-type').textContent = 'Type: ' + objectType;
        document.querySelector('.object-description').innerHTML = objectDescription;
        document.querySelector('.object-image img').src = objectImage;
        document.querySelector('.object-age-rating').innerHTML = ageRatingImage;
        document.querySelector('.object-obtain-instructions').textContent = obtainInstructions;

        // get obj-detail-save and change onclick to objectSave(uuid)
        document.getElementById('obj-detail-save').setAttribute('onclick', 'objectSave("'+uuid+'")');
        document.getElementById('obj-detail-copy').setAttribute('onclick', 'objectCopy("'+uuid+'", "'+objectType+'")');

        // Fetch similar objects and display them
        document.getElementById('similar-obj-dyn-cont').innerHTML = '';
        const similarSearchUrl = 'https://catalogue.destinationhome.live';
        const similarSearchHeaders = {
          'Accept-Encoding': 'gzip, deflate, br',
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Connection': 'keep-alive',
          'DNT': '1',
          'Origin': 'https://catalogue.destinationhome.live'
        };

        const similarSearchBodyData = JSON.stringify({
          query: "{\n  search(query:\"" + objectNameLowercase + "\", locale:DEFAULT) {\n    uuid\ntype\nname\ndescription\nimages{\nsmall\n}\nmetadata {\ntype\ngenders\n}\n  }\n}"
        });

        fetch(similarSearchUrl, {
          method: 'POST',
          headers: similarSearchHeaders,
          body: similarSearchBodyData
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(similarSearchResponse => {
          const similarSearchResults = similarSearchResponse.data.search;
          const similarSearchResultsLength = similarSearchResults.length;
        
          // Ensure the two random indices are different
          let similarSearchResultsRandom = Math.floor(Math.random() * similarSearchResultsLength);
          let similarSearchResultsRandom2;
          do {
            similarSearchResultsRandom2 = Math.floor(Math.random() * similarSearchResultsLength);
          } while (similarSearchResultsRandom2 === similarSearchResultsRandom);
        
          const similarSearchResult1 = similarSearchResults[similarSearchResultsRandom];
          const similarSearchResult2 = similarSearchResults[similarSearchResultsRandom2];

          const similarSearchResult1Image = "https://raw.githubusercontent.com/DestinationHome/ImageArchive/master/" + similarSearchResult1.uuid + "/" + similarSearchResult1.images.small.replace('[THUMBNAIL_ROOT]', '');
          const similarSearchResult2Image = "https://raw.githubusercontent.com/DestinationHome/ImageArchive/master/" + similarSearchResult2.uuid + "/" + similarSearchResult2.images.small.replace('[THUMBNAIL_ROOT]', '');

          const similarObjHTML1 = similarObjSkeleton
            .replace('[SIM_OBJ_IMG]', similarSearchResult1Image)
            .replace('[SIM_OBJ_NAME]', similarSearchResult1.name)
            .replace('[SIM_OBJ_UUID]', similarSearchResult1.uuid)
            .replace('[SIM_OBJ_TYPE]', similarSearchResult1.type);
          const similarObjHTML2 = similarObjSkeleton
            .replace('[SIM_OBJ_IMG]', similarSearchResult2Image)
            .replace('[SIM_OBJ_NAME]', similarSearchResult2.name)
            .replace('[SIM_OBJ_UUID]', similarSearchResult2.uuid)
            .replace('[SIM_OBJ_TYPE]', similarSearchResult2.type);

          const combinedHTML = similarObjHTML1 + similarObjHTML2;
          document.getElementById('similar-obj-dyn-cont').innerHTML = combinedHTML;
        })
        .catch(error => {
          console.error('Fetch error:', error);
        });

        // add fadeIn animation to all
        document.querySelector('.object-title').style.animation = 'fadeIn';
        document.querySelector('.object-title').style.animationDuration = '0.4s';
        document.querySelector('.object-type').style.animation = 'fadeIn';
        document.querySelector('.object-type').style.animationDuration = '0.4s';
        document.querySelector('.object-description').style.animation = 'fadeIn';
        document.querySelector('.object-description').style.animationDuration = '0.4s';
        document.querySelector('.object-image img').style.animation = 'fadeIn';
        document.querySelector('.object-image img').style.animationDuration = '0.4s';
        document.querySelector('.object-age-rating').style.animation = 'fadeIn';
        document.querySelector('.object-age-rating').style.animationDuration = '0.4s';

      } else {
        console.error('Request failed with status:', xhr.status);
      }
    }
  };

  var bodyData = JSON.stringify({
    query: "{\n  object(uuid:\""+uuid+"\", locale:DEFAULT) {\n    type\nname\ndescription\nmaker images{\nsmall\nmaker\n}\nlegal {\nageRating{\nminimumAge\n}\n}\nmetadata {\ntype\ngenders\n}\n }\n}"
  });
  xhr.send(bodyData);
  // do toggleDetails(); after 0.5 seconds
  setTimeout(toggleDetails, 300);
}

function objectSave(uuid) {
    var savedItems = localStorage.getItem('savedItems');
    if (savedItems == null) {
        savedItems = [];
    } else {
        savedItems = JSON.parse(savedItems);
    }
    if (savedItems.includes(uuid)) {
        var notyf = new Notyf();
        notyf.error('Item already saved!');
        return;
    }
    savedItems.push(uuid);
    localStorage.setItem('savedItems', JSON.stringify(savedItems));
    var notyf = new Notyf();
    notyf.success('Item saved!');
}

function showSavedItems() {
    var savedItems = localStorage.getItem('savedItems');
    if (savedItems == null) {
        savedItems = [];
    } else {
        savedItems = JSON.parse(savedItems);
    }
    var modalList = document.getElementById('modal-list');
    var modalListContent = modalList.querySelector('.modal-card-body');
    modalListContent.innerHTML = '';
    if (savedItems.length == 0) {
        modalListContent.innerHTML = '<p>No saved items yet!</p>';
    } else {
        var countr = 0.1;
        var item_counter = 0;
        savedItems.forEach(function(item) {
            item_counter++;
            countr += 0.02;
            var itemHTML = `
            <div id="saved-item-`+item+`" style="animation: fadeInLeft; animation-duration: `+countr+`s; width: 100%; margin-bottom: 10px; background-color: rgb(236, 235, 235); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center;">
                    <img id="saved-item-img-`+item+`" class="preview" src="resc/gray.webp" width="50" height="50" style="animation: fadeIn; animation-duration: 2s; border-radius: 10px;">
                    <p style="margin-left: 10px; animation: fadeIn; animation-duration: 0.5s;"><b id="saved-item-name-`+item+`"></b><br><span style="font-size: 13px;">`+item+`</span></p>
                </div>
                <div>
                    <button style="margin-right: 5px;" class="button" onclick="objectViewFromSaved('`+item+`');">View</button>
                    <button class="button" onclick="removeSpecificItemFromList('`+item+`');">Remove</button>
                </div>
            </div>
            `;
            modalListContent.innerHTML += itemHTML;
        });
    }
}

function populateSavedItems() {
  var savedItems = localStorage.getItem('savedItems');
  if (savedItems == null) {
    savedItems = [];
  } else {
    savedItems = JSON.parse(savedItems);
    savedItems.forEach(function(item) {
      var url = 'https://catalogue.destinationhome.live';
      var xhr = new XMLHttpRequest();
      xhr.open('POST', url, true);

      var headers = {
        'Accept-Encoding': 'gzip, deflate, br',
        'Content-Type': 'application/json',
        'Accept': 'application/json',
        'Connection': 'keep-alive',
        'DNT': '1',
        'Origin': 'https://catalogue.destinationhome.live'
      };

      for (var key in headers) {
        xhr.setRequestHeader(key, headers[key]);
      }

      xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            var searchResults = response.data.search;
            var searchResult = searchResults[0];
            var thisUuid = searchResult.uuid;
            var thisImage = searchResult.images.small.replace('[THUMBNAIL_ROOT]', '');
            var thisImage = "https://raw.githubusercontent.com/DestinationHome/ImageArchive/master/" + thisUuid + "/" + thisImage;
            var thisName = searchResult.name;
            // cut thisName after 15 characters and add a "..."
            if (thisName.length > 15) {
              thisName = thisName.substring(0, 25) + "...";
            }

            document.getElementById('saved-item-name-' + item).textContent = thisName;
            document.getElementById('saved-item-img-' + item).src = thisImage;

            // apply animation: fadeIn; animation-duration: 2s; to saved-item-img again
            document.getElementById('saved-item-img-' + item).style.animation = 'fadeIn';
            document.getElementById('saved-item-img-' + item).style.animationDuration = '2s';

          } else {
            console.error('Request failed with status:', xhr.status);
          }
        }
      };

      var bodyData = JSON.stringify({
        query: "{\n  search(query:\""+item+"\", locale:DEFAULT) {\n    uuid\nname\nimages{\nsmall\n}\n }\n}"
      });

      xhr.send(bodyData);
    });
  }
}

function clearSavedItems() {
    localStorage.removeItem('savedItems');
    var notyf = new Notyf();
    notyf.success('Cleared saved items!');
    showSavedItems();
}

function removeSpecificItemFromList(uuid) {
    var savedItems = localStorage.getItem('savedItems');
    // remove uuid from savedItems (do not use JSON)
    if (savedItems == null) {
        savedItems = [];
    } else {
        savedItems = JSON.parse(savedItems);
        var index = savedItems.indexOf(uuid);
        if (index > -1) {
            savedItems.splice(index, 1);
        }
        localStorage.setItem('savedItems', JSON.stringify(savedItems));
        var notyf = new Notyf();
        notyf.success('Removed item from list!');
        showSavedItems();
        populateSavedItems();
    }
}

function exportList() {
  // save as TXT file where each UUID is each own line with a comma except the last
  var savedItems = localStorage.getItem('savedItems');
  if (savedItems == null) {
    savedItems = [];
  } else {
    savedItems = JSON.parse(savedItems);
    var textToSave = '';
    savedItems.forEach(function(item) {
      // add a comma except for the last item
      if (savedItems.indexOf(item) == savedItems.length - 1) {
        textToSave += item;
      } else {
        textToSave += item + ',\n';
      }
    });
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(textToSave);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'saved-items.txt';
    hiddenElement.click();

    var notyf = new Notyf();
    notyf.success('Exported saved items!');
  }

  if (savedItems.length == 0) {
    var notyf = new Notyf();
    notyf.error('No saved items to export!');
  }
}

function handleFilterClick(event) {
    var filterElement = event.target;
    if (filterElement.classList.contains('button-filter-a')) {
        filterElement.classList.remove('button-filter-a');
        filterElement.classList.add('button-filter-a-sel');
        filterElement.textContent = '✓ ' + filterElement.textContent; // Add checkmark
    } else {
        filterElement.classList.remove('button-filter-a-sel');
        filterElement.classList.add('button-filter-a');
        filterElement.textContent = filterElement.textContent.replace('✓ ', ''); // Remove checkmark
    }
}
var filterElements = document.querySelectorAll('.filter-button');
filterElements.forEach(function(element) {
    element.addEventListener('click', handleFilterClick);
});

// function to show modal details
function toggleDetails() {
    var modalDetails = document.getElementById('modal-details');
    if (modalDetails.classList.contains('is-active')) {
        modalDetails.classList.remove('is-active');
    } else {
        modalDetails.classList.add('is-active');
    }
}

// function to show modal list
function toggleList() {
    var modalList = document.getElementById('modal-list');
    if (modalList.classList.contains('is-active')) {
        modalList.classList.remove('is-active');
    } else {
        showSavedItems();
        modalList.classList.add('is-active');
        populateSavedItems();
    }
}

// when clicking close-modal close all modals
var closeModals = document.querySelectorAll('#close-modal');
closeModals.forEach(function(element) {
    element.addEventListener('click', function() {
        var modalDetails = document.getElementById('modal-details');
        var modalList = document.getElementById('modal-list');
        modalDetails.classList.remove('is-active');
        modalList.classList.remove('is-active');
    });
});

fetchFeatured();
  </script>
</body>
</html>
